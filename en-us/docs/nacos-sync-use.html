<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="keywords" content="nacos-sync-use" />
	<meta name="description" content="nacos-sync-use" />
	<!-- 网页标签标题 -->
	<title>nacos-sync-use</title>
	<link rel="shortcut icon" href="https://img.alicdn.com/tfs/TB1hgJpHAPoK1RjSZKbXXX1IXXa-64-64.png"/>
	<link rel="stylesheet" href="/build/documentation.css" />
</head>
<body>
	<div id="root"><div class="documentation-page" data-reactroot="" data-reactid="1" data-react-checksum="372916670"><header class="header-container header-container-normal" data-reactid="2"><div class="header-body" data-reactid="3"><a href="/en-us/index.html" data-reactid="4"><img class="logo" src="/img/nacos_colorful.png" data-reactid="5"/></a><span class="language-switch language-switch-normal" data-reactid="6">中</span><div class="header-menu" data-reactid="7"><img class="header-menu-toggle" src="/img/menu_gray.png" data-reactid="8"/><ul data-reactid="9"><li class="menu-item menu-item-normal" data-reactid="10"><a href="/en-us/index.html" data-reactid="11">HOME</a></li><li class="menu-item menu-item-normal menu-item-normal-active" data-reactid="12"><a href="/en-us/docs/quick-start.html" data-reactid="13">DOCS</a></li><li class="menu-item menu-item-normal" data-reactid="14"><a href="/en-us/docs/nacos-dev.html" data-reactid="15">TEAM</a></li><li class="menu-item menu-item-normal" data-reactid="16"><a href="/en-us/blog" data-reactid="17">BLOG</a></li><li class="menu-item menu-item-normal" data-reactid="18"><a href="/en-us/community" data-reactid="19">COMMUNITY</a></li><li class="menu-item menu-item-normal" data-reactid="20"><a href="https://mp.weixin.qq.com/s/KH0dEC6cNckoq1M-siiCmg" data-reactid="21">CAMPUS</a></li><li class="menu-item menu-item-normal" data-reactid="22"><a href="http://console.nacos.io/nacos/index.html" data-reactid="23">DEMO-CONSOLE</a></li></ul></div></div></header><div class="bar" data-reactid="24"><div class="bar-body" data-reactid="25"><img src="/img/docs.png" class="front-img" data-reactid="26"/><div class="bar-title" data-reactid="27"><span data-reactid="28">Documentation</span><div class="bone bone-light" data-reactid="29"></div></div><img src="/img/docs.png" class="back-img" data-reactid="30"/></div></div><section class="content-section" data-reactid="31"><div class="content-body" data-reactid="32"><div class="sidemenu" data-reactid="33"><div class="sidemenu-toggle" data-reactid="34"><img src="https://img.alicdn.com/tfs/TB1E6apXHGYBuNjy0FoXXciBFXa-200-200.png" data-reactid="35"/></div><ul data-reactid="36"><li class="menu-item menu-item-level-1" data-reactid="37"><span data-reactid="38">Nacos </span><ul data-reactid="39"><li style="height:180px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="40"><span data-reactid="41"><!-- react-text: 42 -->What is Nacos<!-- /react-text --><img style="transform:rotate(0deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="43"/></span><ul data-reactid="44"><li class="menu-item menu-item-level-3" data-reactid="45"><a href="/en-us/docs/what-is-nacos.html" target="_self" data-reactid="46">What is Nacos</a></li><li class="menu-item menu-item-level-3" data-reactid="47"><a href="/en-us/docs/concepts.html" target="_self" data-reactid="48">Concepts</a></li><li class="menu-item menu-item-level-3" data-reactid="49"><a href="/en-us/docs/architecture.html" target="_self" data-reactid="50">Architecure</a></li><li class="menu-item menu-item-level-3" data-reactid="51"><a href="/en-us/docs/FAQ.html" target="_self" data-reactid="52">FAQ</a></li></ul></li><li style="height:324px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="53"><span data-reactid="54"><!-- react-text: 55 -->Quick Start<!-- /react-text --><img style="transform:rotate(0deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="56"/></span><ul data-reactid="57"><li class="menu-item menu-item-level-3" data-reactid="58"><a href="/en-us/docs/quick-start.html" target="_self" data-reactid="59">Nacos</a></li><li class="menu-item menu-item-level-3" data-reactid="60"><a href="/en-us/docs/quick-start-spring.html" target="_self" data-reactid="61">Nacos Spring</a></li><li class="menu-item menu-item-level-3" data-reactid="62"><a href="/en-us/docs/quick-start-spring-boot.html" target="_self" data-reactid="63">Nacos Spring Boot</a></li><li class="menu-item menu-item-level-3" data-reactid="64"><a href="/en-us/docs/quick-start-spring-cloud.html" target="_self" data-reactid="65">Nacos Spring Cloud</a></li><li class="menu-item menu-item-level-3" data-reactid="66"><a href="/en-us/docs/quick-start-docker.html" target="_self" data-reactid="67">Nacos Docker</a></li><li class="menu-item menu-item-level-3" data-reactid="68"><a href="/en-us/docs/use-nacos-with-dubbo.html" target="_self" data-reactid="69">Nacos with Dubbo</a></li><li class="menu-item menu-item-level-3" data-reactid="70"><a href="/en-us/docs/use-nacos-with-kubernetes.html" target="_self" data-reactid="71">Nacos with K8s</a></li><li class="menu-item menu-item-level-3" data-reactid="72"><a href="/en-us/docs/nacos-sync.html" target="_self" data-reactid="73">Nacos Sync</a></li></ul></li><li style="height:180px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="74"><span data-reactid="75"><!-- react-text: 76 -->User Guide<!-- /react-text --><img style="transform:rotate(0deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="77"/></span><ul data-reactid="78"><li class="menu-item menu-item-level-3" data-reactid="79"><a href="/en-us/docs/sdk.html" target="_self" data-reactid="80">Java SDK</a></li><li class="menu-item menu-item-level-3" data-reactid="81"><a href="/en-us/docs/other-language.html" target="_self" data-reactid="82">Other Language</a></li><li class="menu-item menu-item-level-3" data-reactid="83"><a href="/en-us/docs/open-API.html" target="_self" data-reactid="84">Open-API</a></li><li class="menu-item menu-item-level-3" data-reactid="85"><a href="/en-us/docs/nacos-spring.html" target="_self" data-reactid="86">Nacos Spring</a></li></ul></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="87"><span data-reactid="88"><!-- react-text: 89 -->Admin Guide<!-- /react-text --><img style="transform:rotate(-90deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="90"/></span><ul data-reactid="91"><li class="menu-item menu-item-level-3" data-reactid="92"><a href="/en-us/docs/deployment.html" target="_self" data-reactid="93">Deployment Guide</a></li><li class="menu-item menu-item-level-3" data-reactid="94"><a href="/en-us/docs/cluster-mode-quick-start.html" target="_self" data-reactid="95">Cluster Mode Deployment</a></li><li class="menu-item menu-item-level-3" data-reactid="96"><a href="/en-us/docs/managementAPI.html" target="_self" data-reactid="97">Management OpenAPI</a></li><li class="menu-item menu-item-level-3" data-reactid="98"><a href="/en-us/docs/console-guide.html" target="_self" data-reactid="99">Admin Console Guide</a></li><li class="menu-item menu-item-level-3" data-reactid="100"><a href="/en-us/docs/monitor-guide.html" target="_self" data-reactid="101">Nacos Monitor Guide</a></li><li class="menu-item menu-item-level-3" data-reactid="102"><a href="/en-us/docs/nacos-config-benchmark.html" target="_self" data-reactid="103">Nacos Config Benchmark</a></li><li class="menu-item menu-item-level-3" data-reactid="104"><a href="/en-us/docs/nacos-sync-use.html" target="_self" data-reactid="105">Data Migration to Nacos</a></li></ul></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="106"><span data-reactid="107"><!-- react-text: 108 -->Contributor Guide<!-- /react-text --><img style="transform:rotate(-90deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="109"/></span><ul data-reactid="110"><li class="menu-item menu-item-level-3" data-reactid="111"><a href="/en-us/docs/contributing.html" target="_self" data-reactid="112">Contribute to Nacos</a></li><li class="menu-item menu-item-level-3" data-reactid="113"><a href="/zh-cn/docs/activity.html" target="_self" data-reactid="114">Nacos Activity</a></li><li class="menu-item menu-item-level-3" data-reactid="115"><a href="/en-us/docs/pull-request.html" target="_self" data-reactid="116">Pull Request Template</a></li><li class="menu-item menu-item-level-3" data-reactid="117"><a href="/en-us/docs/how-to-reporting-bugs.html" target="_self" data-reactid="118">How to reporting bugs</a></li><li class="menu-item menu-item-level-3" data-reactid="119"><a href="/en-us/docs/roadmap.html" target="_self" data-reactid="120">Nacos RoadMap</a></li><li class="menu-item menu-item-level-3" data-reactid="121"><a href="/en-us/docs/use-nacos-with-istio.html" target="_self" data-reactid="122">Nacos with Istio</a></li></ul></li><li style="height:36px;overflow:hidden;" class="menu-item menu-item-level-2" data-reactid="123"><span data-reactid="124"><!-- react-text: 125 -->Community<!-- /react-text --><img style="transform:rotate(-90deg);" class="menu-toggle" src="/img/arrow_down.png" data-reactid="126"/></span><ul data-reactid="127"><li class="menu-item menu-item-level-3" data-reactid="128"><a href="/en-us/docs/community.html" target="_self" data-reactid="129">Community</a></li></ul></li></ul></li></ul></div><div class="doc-content markdown-body" data-reactid="130"><h1>NacosSync迁移用户手册</h1>
<p><a name="4a481d2c"></a></p>
<h2>手册目标</h2>
<ul>
<li>启动NacosSync服务</li>
<li>通过一个简单的例子,演示如何将注册到Zookeeper的Dubbo客户端迁移到Nacos
<a name="8dff94cf"></a></li>
</ul>
<h2>系统需要</h2>
<p>启动服务之前,你需要安装下面的服务:</p>
<ul>
<li>64bit OS: Linux/Unix/Mac/Windows supported, Linux/Unix/Mac recommended.</li>
<li>64bit JDK 1.8+: <a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">downloads</a>, <a href="https://docs.oracle.com/cd/E19182-01/820-7851/inst_cli_jdk_javahome_t/">JAVA_HOME settings</a>.</li>
<li>Maven 3.2.x+: <a href="https://maven.apache.org/download.cgi">downloads</a>, <a href="https://maven.apache.org/settings.html">settings</a>.</li>
<li>MySql 5.6.+
<a name="0aaf7364"></a></li>
</ul>
<h2>获取安装包</h2>
<p>有2种方式可以获得NacosSync的安装包:</p>
<ul>
<li>直接下载NacosSync的二进制安装包（下载最新的版本 <a href="https://github.com/nacos-group/nacos-sync/releases%EF%BC%89">https://github.com/nacos-group/nacos-sync/releases）</a></li>
</ul>
<p><a href="https://github.com/nacos-group/nacos-sync/releases">nacosSync.${version}.zip</a></p>
<ul>
<li>从GitHub上下载NacosSync的源码进行构建</li>
</ul>
<p>Package:</p>
<pre><code class="language-basic">cd nacosSync/
mvn clean package -U
</code></pre>
<p>目标文件的路径:</p>
<pre><code class="language-basic">nacos-sync/nacossync-distribution/target/nacosSync.${version}.zip
</code></pre>
<p>解压安装包之后,工程的文件目录结构:</p>
<pre><code class="language-basic">nacosSync
├── LICENSE
├── NOTICE
├── bin
│   ├── nacosSync.sql
│   ├── shutdown.sh
│   └── startup.sh
├── conf
│   ├── application.properties
│   └── logback-spring.xml
├── logs
└── nacosSync-server.${version}.jar
</code></pre>
<p><a name="d41d8cd9"></a></p>
<h3></h3>
<p><a name="2e8b6989"></a></p>
<h2>初始化DB</h2>
<p>系统默认配置的数据库是MySql,也能支持其他的关系型数据库</p>
<ol>
<li>建库,缺省的数据库名字为“nacos_Sync”</li>
<li>数据库表不需要单独创建,默认使用了hibernate的自动建表功能</li>
<li>如果你的环境不支持自动建表,可以使用系统自带的sql脚本建表,脚本放在bin目录下</li>
</ol>
<p><a name="fad227bc"></a></p>
<h2>DB配置</h2>
<p>DB的配置文件放在conf/application.properties中:</p>
<pre><code class="language-basic">spring.datasource.url=jdbc:mysql://127.0.0.1:3306/nacos_sync?characterEncoding=utf8
spring.datasource.username=root
spring.datasource.password=root
</code></pre>
<p><a name="8b7a5bf9"></a></p>
<h2>启动服务器</h2>
<pre><code class="language-bash">$ nacosSync/bin:
sh startup.sh  restart
</code></pre>
<p><a name="24d69918"></a></p>
<h2>检查系统状态</h2>
<p>1.系统日志检查<br />日志的路径在 nacosSync/logs/nacosSync.log,检查是否有异常信息<br />2.检查系统端口(缺省的系统端口是8081,你可以自己定义在application.properties中)</p>
<pre><code class="language-bash"><span class="hljs-variable">$netstat</span> -ano|grep 8081
tcp        0      0 0.0.0.0:8081                0.0.0.0:*                   LISTEN      off (0.00/0/0)
</code></pre>
<p><a name="b5c37706"></a></p>
<h2>控制台</h2>
<p>访问路径:</p>
<pre><code>http://127.0.0.1:8081/#/serviceSync
</code></pre>
<p><img src="https://img.alicdn.com/tfs/TB1EKbkJ3HqK1RjSZFEXXcGMXXa-2866-606.png" alt="image.png"></p>
<p>如果检查没有问题,NacosSync已经正常启动了,NacosSync的部署结构:<br /><img src="https://img.alicdn.com/tfs/TB107nfJ9zqK1RjSZFjXXblCFXa-1412-342.png" alt="image.png"></p>
<p><a name="a9686100"></a></p>
<h2>开始迁移</h2>
<p><a name="f7389286"></a></p>
<h3>迁移信息</h3>
<p>Dubbo服务的部署信息:<br /><img src="https://img.alicdn.com/tfs/TB1Ci_eJ4TpK1RjSZR0XXbEwXXa-938-700.png" alt="image.png"></p>
<p>迁移的服务:</p>
<table>
<thead>
<tr>
<th>Service Name</th>
<th>Version</th>
<th>Group Name</th>
</tr>
</thead>
<tbody>
<tr>
<td>com.alibaba.nacos.api.DemoService</td>
<td>1.0.0</td>
<td>zk</td>
</tr>
</tbody>
</table>
<p><a name="30f7edcb"></a></p>
<h3>添加注册中心集群信息</h3>
<p>1.点击左侧导航栏中的“集群配置”按钮,新增加一个集群,先增加一个Zookeeper集群,选择集群类型为ZK<br />
<img src="https://img.alicdn.com/tfs/TB1oJDnJ7voK1RjSZFwXXciCFXa-2870-1130.png" alt="image.png"></p>
<blockquote>
<p>注意:集群名字可以自定义,但是一旦确认,不能被修改,否则基于此集群增加的任务,在NacosSync重启后,将不会恢复成功</p>
</blockquote>
<p>2.同样的步骤,增加NacosSync集群<br />
<img src="https://img.alicdn.com/tfs/TB1HQPhJVzqK1RjSZFCXXbbxVXa-2846-1042.png" alt="image.png"></p>
<p>添加完成后,可以在列表中查询到<br />
<img src="https://img.alicdn.com/tfs/TB1AX6fJVYqK1RjSZLeXXbXppXa-2864-824.png" alt="image.png"></p>
<p><a name="da01623b"></a></p>
<h3>添加同步任务</h3>
<p>1.增加一个同步任务,从Zookeeper集群同步到Nacos集群,同步的粒度是服务,Zookeeper集群则称为源集群,Nacos集群称为目标集群<br />
<img src="https://img.alicdn.com/tfs/TB1tF_fJVYqK1RjSZLeXXbXppXa-2838-1138.png" alt="imagesd.png"></p>
<p>添加完成之后,可以在服务同步列表中,查看已添加的同步任务:<br />
<img src="https://img.alicdn.com/tfs/TB1l6uJJ9zqK1RjSZPcXXbTepXa-2824-570.png" alt="image.png"></p>
<p>2.同步完成之后,检查下数据是否同步成功到Nacos集群,可以通过Nacos的控制台进行查询<br />
<img src="https://img.alicdn.com/tfs/TB1tPneJ4TpK1RjSZR0XXbEwXXa-2872-828.png" alt="image.png"></p>
<p>此刻,数据已经成功从Zookeeper集群同步到了Nacos集群,部署结构如下:</p>
<p><img src="https://img.alicdn.com/tfs/TB14kriJ6TpK1RjSZKPXXa3UpXa-1724-772.png" alt="image.png">
<a name="a881af49"></a></p>
<h3>让Dubbo客户端连接到Nacos注册中心</h3>
<p><a name="ebc99b4c"></a></p>
<h4>Dubbo Consumer客户端迁移</h4>
<p>Dubbo 已经支持Nacos注册中心,支持的版本为2.5+,需要增加一个Nacos注册中心的Dubbo扩展插件依赖:</p>
<pre><code class="language-basic">&lt;dependency&gt;
      &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
      &lt;artifactId&gt;dubbo-registry-nacos&lt;/artifactId&gt;
			&lt;version&gt;0.0.2&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p><br /><br />增加Nacos客户端的依赖:</p>
<pre><code class="language-basic">&lt;dependency&gt;
        &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt;
        &lt;artifactId&gt;nacos-client&lt;/artifactId&gt;
        &lt;version&gt;0.6.2&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>配置Dubbo Consumer的Dubbo配置文件,让客户端能够找到Nacos集群<br />consumer.yaml</p>
<pre><code class="language-basic">spring:
  application:
name: dubbo-consumer
demo:
  service:
    version: 1.0.0
    group: zk
dubbo:
  registry:
    address: nacos://127.0.0.1:8848
</code></pre>
<p>不需要修改代码,配置更新完毕之后 ,你就可以重启你的应用,使之生效了.</p>
<p>Consumer发布完成之后,目前的部署结构如下:<br />
<img src="https://img.alicdn.com/tfs/TB181fkJ3HqK1RjSZFEXXcGMXXa-1734-878.png" alt="image.png">
<a name="dbe2c2d1"></a></p>
<h4>Dubbo Provider迁移</h4>
<p>在升级Provider之前,你需要确保该Provider发布的服务,都已经配置在NacosSync中,同步的方式为从Nacos同步到Zookeeper,因为Provider升级连接到Nacos之后,需要确保老的Dubbo Consumer客户端能够在Zookeeper上订阅到该Provider的地址,现在,我们增加一个同步任务:<br />
<img src="https://img.alicdn.com/tfs/TB1pdDnJ7voK1RjSZFwXXciCFXa-2872-1060.png" alt="image.png">
<br />
<img src="https://img.alicdn.com/tfs/TB19Ey_J6DpK1RjSZFrXXa78VXa-2842-660.png" alt="image.png"></p>
<blockquote>
<p>注意:Nacos服务同步到Zookeeper,不需要填写版本号,你在选择源集群的时候,版本号的输入框会自动隐藏掉</p>
</blockquote>
<p>同步任务完成后,你就可以升级Provider了,升级Provider的方法,参考升级Consumer的步骤.
<a name="35707fdc"></a></p>
<h3>新的部署结构</h3>
<ul>
<li>在升级的过程中,会有新老版本的客户端同时存在,部署结构如下:</li>
</ul>
<p><img src="https://img.alicdn.com/tfs/TB14Y_iJ3HqK1RjSZFPXXcwapXa-1728-838.png" alt="image.png"></p>
<ul>
<li>在所有的客户端迁移完成之后,部署结构如下:</li>
</ul>
<p><img src="https://img.alicdn.com/tfs/TB1Cg2dJYvpK1RjSZPiXXbmwXXa-1466-864.png" alt="image.png"></p>
<p>现在,Zookeeper集群,NacosSync集群就可以下线了.</p>
<p><a name="1bbbb204"></a></p>
<h3>注意事项</h3>
<ul>
<li>同步任务添加之后,需要确保下服务是否成功同步到目标集群,可以通过目标集群的控制台进行查询</li>
<li>NacosSync支持高可用集群模式部署,你只需要把数据库配置成同一个即可</li>
<li>如果梳理不清楚订阅和发布的服务,建议可以把服务都做双向同步</li>
<li>Dubbo客户端目前不支持Nacos的权重功能,如果你用到了权重功能,需要重新考虑一下方案是否合适</li>
</ul>
</div></div></section><footer class="footer-container" data-reactid="131"><div class="footer-body" data-reactid="132"><img src="/img/nacos_gray.png" data-reactid="133"/><div class="cols-container" data-reactid="134"><div class="col col-12" data-reactid="135"><h3 data-reactid="136">Vision</h3><p data-reactid="137">By providing an easy-to-use service infrastructure such as dynamic service discovery, service configuration, service sharing and management and etc., Nacos help users better construct, deliver and manage their own service platform, reuse and composite business service faster and deliver value of business innovation more quickly so as to win market for users in the era of cloud native and in all cloud environments, such as private, mixed, or public clouds.</p></div><div class="col col-6" data-reactid="138"><dl data-reactid="139"><dt data-reactid="140">Documentation</dt><dd data-reactid="141"><a href="/en-us/docs/what-is-nacos.html" target="_self" data-reactid="142">Overview</a></dd><dd data-reactid="143"><a href="/en-us/docs/quick-start.html" target="_self" data-reactid="144">Quick start</a></dd><dd data-reactid="145"><a href="/en-us/docs/contributing.html" target="_self" data-reactid="146">Developer guide</a></dd></dl></div><div class="col col-6" data-reactid="147"><dl data-reactid="148"><dt data-reactid="149">Resources</dt><dd data-reactid="150"><a href="/en-us/community/index.html" target="_self" data-reactid="151">Community</a></dd><dd data-reactid="152"><a href="https://www.aliyun.com/product/acm?source_type=nacos_pc_20181219" target="_self" data-reactid="153">Cloud Service ACM</a></dd><dd data-reactid="154"><a href="https://www.aliyun.com/product/edas?source_type=nacos_pc_20181219" target="_self" data-reactid="155">Cloud Service EDAS</a></dd><dd data-reactid="156"><a href="https://www.aliyun.com/product/ahas?source_type=nacos_pc_20190225" target="_self" data-reactid="157">Cloud Service AHAS</a></dd></dl></div></div><div class="copyright" data-reactid="158"><span data-reactid="159">@ 2018 The Nacos Authors | An Alibaba Middleware (Aliware) Project</span></div></div></footer></div></div>
	<script src="https://f.alicdn.com/react/15.4.1/react-with-addons.min.js"></script>
	<script src="https://f.alicdn.com/react/15.4.1/react-dom.min.js"></script>
	<script>
		window.rootPath = '';
  </script>
	<script src="/build/documentation.js"></script>
</body>
</html>